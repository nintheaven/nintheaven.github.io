<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta name="description" content="网站描述">
    <meta name="keyword" content="">

    <title>mybatis分页查询 | 九天博客</title>
    <link rel="shortcut icon" href="/images/logo.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
<link rel="stylesheet" href="/css/style.css">

    
        
<link rel="stylesheet" href="/css/index.css">

    
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <header>
    
    <div class="navbar-container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="/images/logo.png" alt="" width="30" height="24" class="d-inline-block align-text-top">
                九天博客
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 35vh;">
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/">首页</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/projects">项目</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/essays">随笔</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/notes">笔记</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/about">关于</a>
                    </li>
                    
                </ul>

                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">搜索</button>
                </form>
            </div>
        </div>
    </nav>
</div>

    
    
</header>

    <main><h1>mybatis分页查询</h1>

<span>MyBatis</span>

<span>2022-10-11</span>
<div><span id="more"></span>

<h2 id="准备数据库和表"><a href="#准备数据库和表" class="headerlink" title="准备数据库和表"></a>准备数据库和表</h2><p>以图书为例，图书与其作者是“多对一”的关系。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*作者*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> author</span><br><span class="line">(</span><br><span class="line">    id   <span class="type">INT</span> UNSIGNED       <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">63</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;作者名&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*图书*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> book</span><br><span class="line">(</span><br><span class="line">    id        <span class="type">INT</span> UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    name      <span class="type">VARCHAR</span>(<span class="number">127</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图书名&#x27;</span>,</span><br><span class="line">    author_id <span class="type">INT</span> UNSIGNED <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;作者ID&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB;</span><br></pre></td></tr></table></figure>

<p>添加一些测试数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*添加作者*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> author (id, name)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;莫言&#x27;</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="string">&#x27;余华&#x27;</span>),</span><br><span class="line">       (<span class="number">3</span>, <span class="string">&#x27;鲁迅&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*添加图书*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (id, name, author_id)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;红高粱&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="string">&#x27;檀香刑&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="number">3</span>, <span class="string">&#x27;丰乳肥臀&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="number">4</span>, <span class="string">&#x27;活着&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">       (<span class="number">5</span>, <span class="string">&#x27;许三观卖血记&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">       (<span class="number">6</span>, <span class="string">&#x27;兄弟&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">       (<span class="number">7</span>, <span class="string">&#x27;阿Q正传&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">8</span>, <span class="string">&#x27;祝福&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">9</span>, <span class="string">&#x27;孔乙己&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">10</span>, <span class="string">&#x27;故乡&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">11</span>, <span class="string">&#x27;狂人日记&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">12</span>, <span class="string">&#x27;药&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">13</span>, <span class="string">&#x27;端午节&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">14</span>, <span class="string">&#x27;社戏&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">15</span>, <span class="string">&#x27;一件小事&#x27;</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h2 id="定义实体类"><a href="#定义实体类" class="headerlink" title="定义实体类"></a>定义实体类</h2><p>作者Author</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; books;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>图书Book</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Long authorId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Author author;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义Mapper接口并创建对应的xml映射文件"><a href="#定义Mapper接口并创建对应的xml映射文件" class="headerlink" title="定义Mapper接口并创建对应的xml映射文件"></a>定义Mapper接口并创建对应的xml映射文件</h2><p>AuthorMapper.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">public interface AuthorMapper &#123;</span><br><span class="line">    List&lt;Author&gt; selectMany(@Param(&quot;size&quot;)Integer size,@Param(&quot;offset&quot;)Integer offset);</span><br><span class="line">    int count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookMapper</span> &#123;</span><br><span class="line">    List&lt;Book&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">    List&lt;Book&gt; <span class="title function_">selectMany</span><span class="params">(<span class="meta">@Param(&quot;size&quot;)</span>Integer size, <span class="meta">@Param(&quot;offset&quot;)</span>Integer offset)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="逻辑分页：使用Java代码分页"><a href="#逻辑分页：使用Java代码分页" class="headerlink" title="逻辑分页：使用Java代码分页"></a>逻辑分页：使用Java代码分页</h2><p>最简单的分页方式是一次性查出全部记录，然后在使用Java代码实现分页。这是一种“假分页”，是在内存中处理的，称为<strong>逻辑分页</strong>。这么做意义不大。</p>
<p>以分页查询图书为例：</p>
<p>查询全部图书的SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Book&quot;</span>&gt;</span></span><br><span class="line">    SELECT id,name,author_id FROM book;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在Java代码中，使用 <code>selectAll()</code> 方法获取全部图书列表，然后根据页码和每页数量截取子列表，实现分页功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageNum   页码,从1开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize  每页数量</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Book&gt; <span class="title function_">getBooks</span><span class="params">(SqlSessionFactory sqlSessionFactory, Integer pageNum, Integer pageSize)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pageNum == <span class="literal">null</span> || pageNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        pageNum = <span class="number">1</span>; <span class="comment">// 默认返回第1页数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pageSize == <span class="literal">null</span> || pageSize &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        pageSize = <span class="number">5</span>; <span class="comment">// 默认返回5条数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);)&#123;</span><br><span class="line">        <span class="type">BookMapper</span> <span class="variable">bookMapper</span> <span class="operator">=</span> session.getMapper(BookMapper.class);</span><br><span class="line">        List&lt;Book&gt; books = bookMapper.selectAll();</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromIndex</span> <span class="operator">=</span> pageSize * (pageNum-<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">toIndex</span> <span class="operator">=</span> fromIndex + pageSize;</span><br><span class="line">        <span class="keyword">return</span> books.subList(fromIndex,toIndex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="物理分页分页：使用limit语句分页"><a href="#物理分页分页：使用limit语句分页" class="headerlink" title="物理分页分页：使用limit语句分页"></a>物理分页分页：使用limit语句分页</h2><p>利用SQL中的 <code>limit</code> 语句，每次只从数据库查询需要的一页数据，这才是真正的分页，称为<strong>物理分页</strong>。</p>
<p>还是以查询图书为例：</p>
<p>分页查询图书的SQL语句如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMany&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Book&quot;</span>&gt;</span></span><br><span class="line">    SELECT id,name,author_id FROM book LIMIT #&#123;size&#125; OFFSET #&#123;offset&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在Java代码中，使用 <code>selectMany()</code> 方法获取一页数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Book&gt; <span class="title function_">getBooks</span><span class="params">(SqlSessionFactory sqlSessionFactory, Integer pageNum, Integer pageSize)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pageNum == <span class="literal">null</span> || pageNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        pageNum = <span class="number">1</span>; <span class="comment">// 默认返回第1页数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pageSize == <span class="literal">null</span> || pageSize &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        pageSize = <span class="number">5</span>; <span class="comment">// 默认返回5条数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);)&#123;</span><br><span class="line">        <span class="type">BookMapper</span> <span class="variable">bookMapper</span> <span class="operator">=</span> session.getMapper(BookMapper.class);</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> pageSize * (pageNum-<span class="number">1</span>);</span><br><span class="line">        List&lt;Book&gt; books = bookMapper.selectMany(pageSize, offset);</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="将分页数据封装到-Page-对象中"><a href="#将分页数据封装到-Page-对象中" class="headerlink" title="将分页数据封装到 Page 对象中"></a>将分页数据封装到 <code>Page</code> 对象中</h2><p>在实际开发中，为了方便前端创建分页器，后端一般需要将分页数据封装到一个 <code>Page</code> 对象中返回。</p>
<p>自定义分页类<code>Page&lt;E&gt;</code>，使用构建器模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pager</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer pageNum;</span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">    <span class="keyword">private</span> Integer totalPages;</span><br><span class="line">    <span class="keyword">private</span> Integer totalSize;</span><br><span class="line">    <span class="keyword">private</span> List&lt;E&gt; items;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Pager</span><span class="params">(Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (pageNum == <span class="literal">null</span> || pageNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            pageNum = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pageSize == <span class="literal">null</span> || pageSize &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            pageSize = <span class="number">15</span>; <span class="comment">// 默认1页15条数据</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.pageNum = pageNum;</span><br><span class="line">        <span class="built_in">this</span>.pageSize = pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getPageNum</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pageNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPageNum</span><span class="params">(Integer pageNum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pageNum = pageNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getPageSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPageSize</span><span class="params">(Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pageSize = pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getTotalPages</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalPages;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalPages</span><span class="params">(Integer totalPages)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.totalPages = totalPages;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getTotalSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalSize</span><span class="params">(Integer totalSize)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.totalSize = totalSize;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置总页数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">totalPages</span> <span class="operator">=</span> totalSize / pageSize;</span><br><span class="line">        <span class="keyword">if</span> (totalSize % pageSize != <span class="number">0</span>) &#123;</span><br><span class="line">            ++totalPages;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.totalPages = totalPages;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当前页码不允许大于总页数</span></span><br><span class="line">        <span class="built_in">this</span>.pageNum = Math.min(<span class="built_in">this</span>.pageNum, <span class="built_in">this</span>.totalPages);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 每页的数量不允许大于总数量</span></span><br><span class="line">        <span class="built_in">this</span>.pageSize = Math.min(<span class="built_in">this</span>.pageSize, <span class="built_in">this</span>.totalSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;E&gt; <span class="title function_">getItems</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setItems</span><span class="params">(List&lt;E&gt; items)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Pager&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;pageNum=&quot;</span> + pageNum +</span><br><span class="line">                <span class="string">&quot;, pageSize=&quot;</span> + pageSize +</span><br><span class="line">                <span class="string">&quot;, totalPages=&quot;</span> + totalPages +</span><br><span class="line">                <span class="string">&quot;, totalSize=&quot;</span> + totalSize +</span><br><span class="line">                <span class="string">&quot;, items=&quot;</span> + items +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以分页查询图书为例，首先查询总共有多少条记录，然后，分页查询具体数据，最后，构造<code>Page</code>对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Page&lt;Book&gt; <span class="title function_">getPage</span><span class="params">(SqlSessionFactory sqlSessionFactory, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);) &#123;</span><br><span class="line">        <span class="type">BookMapper</span> <span class="variable">bookMapper</span> <span class="operator">=</span> session.getMapper(BookMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">totalSize</span> <span class="operator">=</span> bookMapper.count(); <span class="comment">// 图书总数</span></span><br><span class="line">        <span class="comment">// 构造Page对象</span></span><br><span class="line">        Pager&lt;Object&gt; pager = <span class="keyword">new</span> <span class="title class_">Pager</span>&lt;&gt;(pageNum, pageSize);</span><br><span class="line">        pager.setTotalSize(totalSize);</span><br><span class="line">        </span><br><span class="line">        List&lt;Book&gt; books; <span class="comment">// 图书列表</span></span><br><span class="line">        <span class="keyword">if</span> (totalSize == <span class="number">0</span>) &#123;</span><br><span class="line">            totalPages = <span class="number">0</span>;</span><br><span class="line">            books = Collections.emptyList();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            totalPages = totalSize / pageSize;</span><br><span class="line">            <span class="keyword">if</span> (totalSize % pageSize != <span class="number">0</span>) &#123;</span><br><span class="line">                totalPages++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 查询图书列表</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> pageSize * (pageNum - <span class="number">1</span>);</span><br><span class="line">            books = bookMapper.selectMany(pageSize, offset);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置数据</span></span><br><span class="line">        pager.setItems(books);</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一对多、多对多查询结果的分页"><a href="#一对多、多对多查询结果的分页" class="headerlink" title="一对多、多对多查询结果的分页"></a>一对多、多对多查询结果的分页</h2><p>一对多、多对多查询中，如果直接对联结查询的结果进行limit分页，返回的记录数是不对的</p>
<p>以查询作者及其图书为例。</p>
<p>查询全部作者及其图书</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.id <span class="keyword">AS</span> id,</span><br><span class="line">       A.name <span class="keyword">AS</span> name,</span><br><span class="line">       B.id <span class="keyword">AS</span> book_id,</span><br><span class="line">       B.name <span class="keyword">AS</span> book_name</span><br><span class="line"><span class="keyword">FROM</span> author <span class="keyword">AS</span> A <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> book <span class="keyword">AS</span> B <span class="keyword">ON</span> A.id <span class="operator">=</span> B.author_id</span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+----+-----------+---------+--------------------+</span><br><span class="line">| id | name      | book_id | book_name          |</span><br><span class="line">+----+-----------+---------+--------------------+</span><br><span class="line">|  1 | 莫言      |       1 | 红高粱             |</span><br><span class="line">|  1 | 莫言      |       2 | 檀香刑             |</span><br><span class="line">|  1 | 莫言      |       3 | 丰乳肥臀           |</span><br><span class="line">|  2 | 余华      |       4 | 活着               |</span><br><span class="line">|  2 | 余华      |       5 | 许三观卖血记       |</span><br><span class="line">|  2 | 余华      |       6 | 兄弟               |</span><br><span class="line">|  3 | 鲁迅      |       7 | 阿Q正传            |</span><br><span class="line">|  3 | 鲁迅      |       8 | 祝福               |</span><br><span class="line">|  3 | 鲁迅      |       9 | 孔乙己             |</span><br><span class="line">|  4 | 路遥      |      10 | 平凡的世界         |</span><br><span class="line">|  4 | 路遥      |      11 | 人生               |</span><br><span class="line">|  5 | 贾平凹    |      12 | 秦腔               |</span><br><span class="line">|  5 | 贾平凹    |      13 | 废都               |</span><br><span class="line">|  6 | 陈忠实    |      14 | 白鹿原             |</span><br><span class="line">+----+-----------+---------+--------------------+</span><br></pre></td></tr></table></figure>

<p>现在对作者进行分页，只返回前2位作者及其图书。如果直接在联结查询语句之后进行分页</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.id <span class="keyword">AS</span> id,</span><br><span class="line">       A.name <span class="keyword">AS</span> name,</span><br><span class="line">       B.id <span class="keyword">AS</span> book_id,</span><br><span class="line">       B.name <span class="keyword">AS</span> book_name</span><br><span class="line"><span class="keyword">FROM</span> author <span class="keyword">AS</span> A <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> book <span class="keyword">AS</span> B <span class="keyword">ON</span> A.id <span class="operator">=</span> B.author_id</span><br><span class="line">LIMIT <span class="number">2</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>结果如下，显然是不对的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+---------+-----------+</span><br><span class="line">| id | name   | book_id | book_name |</span><br><span class="line">+----+--------+---------+-----------+</span><br><span class="line">|  1 | 莫言   |       1 | 红高粱    |</span><br><span class="line">|  1 | 莫言   |       2 | 檀香刑    |</span><br><span class="line">+----+--------+---------+-----------+</span><br></pre></td></tr></table></figure>

<p>正确的查询方式应该是：</p>
<ol>
<li>先对作者表进行分页，查询出前2位作者的信息</li>
<li>将上面的查询作为<strong>子查询</strong>，与图书表进行<strong>联结查询</strong></li>
</ol>
<p>正确的SQL语句如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.id   <span class="keyword">AS</span> id,</span><br><span class="line">       A.name <span class="keyword">AS</span> name,</span><br><span class="line">       B.id   <span class="keyword">AS</span> book_id,</span><br><span class="line">       B.name <span class="keyword">AS</span> book_name</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> author LIMIT <span class="number">2</span> <span class="keyword">OFFSET</span> <span class="number">0</span>) <span class="keyword">AS</span> A</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> book <span class="keyword">AS</span> B <span class="keyword">ON</span> A.id <span class="operator">=</span> B.author_id;</span><br></pre></td></tr></table></figure>

<p>查询结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+---------+--------------------+</span><br><span class="line">| id | name   | book_id | book_name          |</span><br><span class="line">+----+--------+---------+--------------------+</span><br><span class="line">|  1 | 莫言   |       1 | 红高粱             |</span><br><span class="line">|  1 | 莫言   |       2 | 檀香刑             |</span><br><span class="line">|  1 | 莫言   |       3 | 丰乳肥臀           |</span><br><span class="line">|  2 | 余华   |       4 | 活着               |</span><br><span class="line">|  2 | 余华   |       5 | 许三观卖血记       |</span><br><span class="line">|  2 | 余华   |       6 | 兄弟               |</span><br><span class="line">+----+--------+---------+--------------------+</span><br></pre></td></tr></table></figure>

<p>最终，在 <em>AuthorMapper.xml</em> 文件中，分页查询作者及其图书信息的代码如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;authorResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Author&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;books&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;book_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;book_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMany&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;authorResultMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT A.id   AS id,</span><br><span class="line">           A.name AS name,</span><br><span class="line">           B.id   AS book_id,</span><br><span class="line">           B.name AS book_name</span><br><span class="line">    FROM (SELECT id, name FROM author LIMIT #&#123;size&#125; OFFSET #&#123;offset&#125;) AS A</span><br><span class="line">        LEFT OUTER JOIN book AS B ON A.id = B.author_id;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="自定义插件实现分页"><a href="#自定义插件实现分页" class="headerlink" title="自定义插件实现分页"></a>自定义插件实现分页</h2><p>参看文档：<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#plugins">https://mybatis.org/mybatis-3/zh/configuration.html#plugins</a></p>
<p>文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenpi/p/10498921.html">https://www.cnblogs.com/chenpi/p/10498921.html</a></p>
<h2 id="利用pagehelper插件实现分页"><a href="#利用pagehelper插件实现分页" class="headerlink" title="利用pagehelper插件实现分页"></a>利用pagehelper插件实现分页</h2><p>文档：<a target="_blank" rel="noopener" href="https://pagehelper.github.io/">https://pagehelper.github.io/</a></p>
<p>查看文章：<a target="_blank" rel="noopener" href="https://lypzz.com/posts/spring-boot%E7%B3%BB%E5%88%97/spring-boot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90mybatis/">spring-boot系列-集成mybatis</a></p>
<h2 id="使用mybatis-plus实现分页"><a href="#使用mybatis-plus实现分页" class="headerlink" title="使用mybatis-plus实现分页"></a>使用mybatis-plus实现分页</h2><p>略</p>
</div>
<div>END</div></main>

    <footer>
页底
</footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
</body>
</html>